var C5MigrationConsole=new function(){this.featureCounter=1;this.showMigrationConsoleScreen=function(){if(typeof (ZCGlobal)!="undefined"&&ZCGlobal.showC5MigrationConsole){C5MigrationConsole.initBinding();$("#c5MigrationContainer").show();$(document.body).addClass("zc-mig-console-c4-alert")}};this.initBinding=function(){$("#validateNowC5").off("click").on("click",function(){window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_blank");$("#c5MigrationContainer").hide();$(document.body).removeClass("zc-mig-console-c4-alert")});$("#validateLaterC5").off("click").on("click",function(){C5MigrationConsole.upgradeLater()});$("#updateNewPop").off("click").on("click",function(){C5MigrationConsole.showNewPopFailureBlock()});$("a[elname='contactSupport']").off("click").on("click",function(){C5MigrationConsole.mailToSupport()});$(".zc-mig-pagination-right-btn").off("click").on("click",function(){C5MigrationConsole.showNextC5Features()});$(".zc-mig-pagination-left-btn").off("click").on("click",function(){C5MigrationConsole.showPrevC5Features()});$("#migrateToC5").off("click").on("click",function(){C5MigrationConsole.showMigrationConfirmation()});$("#migrateToC5").parent().mouseenter(function(){$(this).addClass("zc-mig-upgrade-btn-focus")}).mouseleave(function(){if(C5MigrationConsole.featureCounter!=5){$(this).removeClass("zc-mig-upgrade-btn-focus")}});C5MigrationConsole.getMaxHeight($("#publicComponentsMain"));C5MigrationConsole.getMaxHeight($("#paymentConfigMain"))};this.upgradeLater=function(){var A={};if(ZCGlobal.csrfTokenName!=undefined){A[ZCGlobal.csrfTokenName]=ZCGlobal.csrfToken}else{A[getCsrfParamName()]=getCsrfParamValue()}$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/upgradeLater",type:"POST",data:A,success:function(B){$("#c5MigrationContainer").hide();$(document.body).removeClass("zc-mig-console-c4-alert")}})};this.showNewPopulationSuccess=function(){$("#updateNewPop").hide();$("#newPopSuccess").show()};this.showNewPopFailureButton=function(){$("#updateNewPop").hide();$("#newPopFailButton").show()};this.showNewPopFailureBlock=function(){$("#newPopMigContainer").hide();$("#newPopFailContainer").show()};this.mailToSupport=function(){$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/contactSupportForDeluge",data:ZCGlobal.csrfTokenName+"="+ZCGlobal.csrfToken,type:"POST",beforeSend:showLoading,success:function(A){showToast("mail has been sent to support@zohocreator.com");hideLoading()}})};this.showNextC5Features=function(){prevFeature="c5Feature"+C5MigrationConsole.featureCounter;nextFeature="c5Feature"+(++C5MigrationConsole.featureCounter);if(C5MigrationConsole.featureCounter==5){$("#migrateToC5").parent().addClass("zc-mig-upgrade-btn-focus");$("#migrateToC5").parent().addClass("zc-mig-upgrade-btn-active")}$("#"+prevFeature).hide();$("#"+nextFeature).show()};this.showPrevC5Features=function(){prevFeature="c5Feature"+C5MigrationConsole.featureCounter;nextFeature="c5Feature"+(--C5MigrationConsole.featureCounter);if(C5MigrationConsole.featureCounter<5){$("#migrateToC5").parent().removeClass("zc-mig-upgrade-btn-focus");$("#migrateToC5").parent().removeClass("zc-mig-upgrade-btn-active")}$("#"+prevFeature).hide();$("#"+nextFeature).show()};this.showMigrationConfirmation=function(){var A={isEnable:true};A[ZCGlobal.csrfTokenName]=ZCGlobal.csrfToken;iCustomizePopup({title:"Upgrading to C5",body:"<span class='zc-mig-upgrade-text'>By clicking Upgrade, you agree to upgrade your account to Creator 5</span>",buttons:[{name:"Upgrade",type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],success:function(B){$.ajax({beforeSend:showLoading,url:"/userhome/"+ZCGlobal.scopeName+"/updateC5Prop",type:"POST",data:A}).done(function(C){if(C.success){C5MigrationConsole.showMigrationRunning();return }else{if(C.error&&C.errorType=="migrationError"){window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_self")}else{if(C.error&&C.errorType=="noPermission"){iAlert(C.error);return }else{if(C.error&&C.errorType=="sandboxDependency"){if(C.htmlContent){iCustomizePopup({title:"",body:C.htmlContent,button:i18n.ok,success:function(){return true},failure:$.noop})}else{iAlert("Something went wrong..")}return }else{iAlert("Something went wrong..")}}}}}).always(function(){hideLoading()});return true},failure:function(){}})};this.showMigrationRunning=function(){$("#migMainContainer").hide();$("#afterMigrationSuccess").hide();$(".zc-mig-success-container").addClass("zc_mig_loading");$("#loader").show();$(".zc-mig-content-header").hide();$("#migrationRunning").addClass("zc-mig-started").show();setTimeout(function(){C5MigrationConsole.checkStatus()},1000)};this.showAfterMigrationSuccess=function(){$(".zc-mig-main-header").hide();$("#afterMigrationSuccess").show()};this.showAfterMigrationFailure=function(){$("#migMainContainer").hide();$(".zc-mig-main-header").hide();$("#afterMigrationFailure").show()};this.checkStatus=function(){$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/checkMigrationStatus",type:"GET",success:function(B,A,C){if(B.status!==undefined&&B.status==1){setTimeout(function(){C5MigrationConsole.checkStatus()},5000)}else{window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_self")}}})};this.showPopup=function(A){iCustomizePopup({title:$("#"+A).find(".zc-mig-success-msg-alert-elem-title").text(),body:$("#"+A).html(),parentClass:"zc-mic-console-userpermission-dialog",afterOpen:function(B){$(B).find(".zc-mig-success-msg-alert-elem-title").hide();$(B).find("#dem-app-search-field").off("keyup").on("keyup",function(){C5MigrationConsole.filter(A,$(event.target).val())})}})};this.filter=function(C,E){E=E.trim();var B=new RegExp(/^\d+$/);var F=new RegExp(E.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"i");var D;if(C==="oldPaymentApps"||C==="publicShareComponents"){D=$(".zc-mic-console-userpermission-dialog").find(".zc-mig-fail-app-comp-details ")}else{D=$(".zc-mic-console-userpermission-dialog").find(".zc-mig-c5-dshbrd-preview-container").find(".zc-mig-c5-dshbrd-applist ")}D.hide();var A=D.filter(function(){return((F==""||F.test($(this).attr("linkName"))||F.test($(this).attr("dispName"))||F.test($(this).find(".zc-mig-app-fail-comp-list").attr("formDispName"))))}).show().length;if(A==0){$(".zc-mic-console-userpermission-dialog").find("#noresult").find("p").text(i18n["zc.onboarding.noappstobedisplayed"]);$(".zc-mic-console-userpermission-dialog").find("#noresult").show()}else{$(".zc-mic-console-userpermission-dialog").find("#noresult").hide()}};this.getMaxHeight=function(D){var E=$(D).find(".zc-mig-fail-app-comp-details");var C=0;for(var A=0;A<E.length;A++){var B=$(E[A]).outerHeight();if(B>C){C=B}}for(var A=0;A<E.length;A++){$(E[A]).outerHeight(C+"px")}}}();